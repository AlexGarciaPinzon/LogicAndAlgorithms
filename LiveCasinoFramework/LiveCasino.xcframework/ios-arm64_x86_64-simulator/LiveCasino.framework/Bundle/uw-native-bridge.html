<!DOCTYPE html>
<html>
<head>
  <meta name="apple-mobile-web-app-capable"
        content="yes">
  <meta id="viewport"
        name="viewport"
        content="user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
  <meta http-equiv="X-UA-Compatible"
        content="IE=edge"/>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      min-height: 100%;
      min-width: 100%;
      text-align: center;
      height: 100%;
      width: 100%;
    }
    iframe
    {
      border:0;
      margin:0;
      width:100%;
      height:100%;
      min-height: 100%;
    }
  </style>
</head>
<body>
<script>
  const jsToNativeEvent = window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.jsToNativeEvent || window.jsToNativeEvent;

  if (jsToNativeEvent) {

    const iframe = document.createElement('iframe');
    iframe.src = "index.html" + window.location.search;
    document.body.appendChild(iframe);

    const platformWindow = iframe.contentWindow;

    // forward post messages only from iframe
    window.addEventListener(
      'message',
      function (ev) {
        if (ev.source === platformWindow) {
          jsToNativeEvent.postMessage(ev.data)
        }
      }
    );

    // add function to be used by ios to send messages to platform
    window.nativeToJsEvent = function (data) {
      platformWindow.postMessage(JSON.stringify(data), '*');
    };
  } else {
    document.body.innerHTML = "<span style='color: red'>" +
      (window.webkit
        ? "Wrong WKWebView configuration: userContentController doesn't have jsToNativeEvent WKScriptMessageHandler!"
        : "Page is opened in wrong environment, window doesn't contain jsToNativeEvent") +
      "</span>"
  }
</script>
</body>
</html>

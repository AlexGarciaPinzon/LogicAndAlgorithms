!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Decoder=t()}(this,function(){!function(){(e=this)||("undefined"!=typeof window?e=window:"undefined"!=typeof self&&(e=self))}();var e,t=function(){var e=document.getElementById("decoder-avc-srpt");e&&e.parentNode&&e.parentNode.removeChild(e),"undefined"!=typeof Module&&(Module=void 0)},n=function(n,r,i){var a,o,f=!1;return(()=>{var e;let n=i?"wasm-avc.min.js":"asm-avc.min.js";return"undefined"!=typeof importScripts?async function(){await importScripts(n)}():(t(),(e=document.createElement("script")).id="decoder-avc-srpt",e.setAttribute("type","text/javascript"),new Promise(function(t,r){var i=!1;e.src=n,e.onload=e.onreadystatechange=function(){i||e.readyState&&"loaded"!==e.readyState&&"complete"!==e.readyState||(i=!0,e.onload=e.onreadystatechange=null,t(e))},e.onerror=r,document.body.appendChild(e)}))})().then(()=>{void 0!==e&&e.Module&&(o=e.Module),"undefined"!=typeof Module&&(o=Module),o._broadwayOnHeadersDecoded=n,o._broadwayOnPictureDecoded=r,o.onRuntimeInitialized=function(){f=!0,a&&a(o)}}).catch(e=>{console.error(e)}),function(e){f?e(o):a=e}};return function(){"use strict";var r=function(){return(new Date).getTime()};"undefined"!=typeof performance&&performance.now&&(r=function(){return performance.now()});var i=function(e){this.options=e||{},this.now=r;var i,a,f,s=(function(e,t,n){var f,s=this.pictureBuffers[e];s||(s=this.pictureBuffers[e]=a(e,t*n*3/2));var d=!1;if(this.infoAr.length&&(d=!0,f=this.infoAr),this.infoAr=[],this.options.rgb){i||(i=o(t,n)),i.inp.set(s),i.doit();var u=new Uint8Array(i.outSize);return u.set(i.out),d&&(f[0].finishDecoding=r()),void this.onPictureDecoded(u,t,n,f)}d&&(f[0].finishDecoding=r()),this.onPictureDecoded(s,t,n,f)}).bind(this);this.options.sliceMode&&(s=(function(e,t,n,i){var o=this.pictureBuffers[e];o||(o=this.pictureBuffers[e]=a(e,t*n*3/2));var s,d=this.pictureBuffers[i];d||(d=this.pictureBuffers[i]=f(i,18)),this.infoAr.length&&(s=this.infoAr),this.infoAr=[],s[0].finishDecoding=r();for(var u=[],c=0;c<20;++c)u.push(d[c]);s[0].sliceInfoAr=u,this.onPictureDecoded(o,t,n,s)}).bind(this));var d=n.apply({},[function(){},s,this.options.useWasm]),u=this;this.onPictureDecoded=function(e,t,n,r){},this.onDecoderReady=function(){};var c=[];this.decode=function(e,t,n){c.push([e,t,n])},this.destroy=function(){t()},d(function(e){e.HEAP8;var t=e.HEAPU8;e.HEAP16,e.HEAP32,e._broadwayInit(),a=function(e,n){return t.subarray(e,e+n)},f=function(e,n){return new Uint32Array(t.buffer,e,n)},u.streamBuffer=a(e._broadwayCreateStream(1048576),1048576),u.pictureBuffers={},u.infoAr=[];var n=0;if(u.options.sliceMode?(n=u.options.sliceNum,u.decode=function(t,i,a){u.infoAr.push(i),i.startDecoding=r();var o,f=i.nals;if(!f){f=[],i.nals=f;var s=t.length,d=!1,c=0,h=0;for(o=0;o<s;++o)if(1===t[o]&&0===t[o-1]&&0===t[o-2]){var l=o-2;0===t[o-3]&&(l=o-3),d&&f.push({offset:c,end:l,type:31&t[h]}),c=l,h=l+3,0===t[o-3]&&(h=l+4),d=!0}d&&f.push({offset:c,end:o,type:31&t[h]})}var v,p=0,y=0;for(o=0;o<f.length;++o)1===f[o].type||5===f[o].type?(p===n&&(v=t.subarray(f[o].offset,f[o].end),u.streamBuffer[y]=0,y+=1,u.streamBuffer.set(v,y),y+=v.length),p+=1):(v=t.subarray(f[o].offset,f[o].end),u.streamBuffer[y]=0,y+=1,u.streamBuffer.set(v,y),y+=v.length,e._broadwayPlayStream(y),y=0);a(),e._broadwayPlayStream(y)}):u.decode=function(t,n){n&&(u.infoAr.push(n),n.startDecoding=r()),u.streamBuffer.set(t),e._broadwayPlayStream(t.length)},c.length){var i=0;for(i=0;i<c.length;++i)u.decode(c[i][0],c[i][1],c[i][2]);c=[]}u.onDecoderReady(u)})};i.prototype={};var a={},o=function(t,n){var r=t+"x"+n;if(a[r])return a[r];for(var i=t*n,o=(0|i)>>2,f=i+o+o,s=t*n*4,d=f+s+67108864,u=16777216;u<d;)u+=16777216;var c=new ArrayBuffer(u),h=function(e,t,n){"use asm";var r=e.Math.imul,i=e.Math.min,a=e.Math.max,o=e.Math.pow,f=new e.Uint8Array(n),s=new e.Uint32Array(n),d=new e.Uint8Array(n),u=new e.Uint8Array(n),c=new e.Uint32Array(n),h=0,l=0,v=0,p=0,y=0,g=0,w=0,m=0,A=0,b=0;function D(e,t){e=e|0;t=t|0;var n=0;var i=0;h=e;A=r(e,4)|0;l=t;v=r(h|0,l|0)|0;p=(v|0)>>2;g=r(r(h,l)|0,4)|0;y=v+p|0+p|0;m=0;w=m+g|0;b=w+y|0;i=~~+o(2,24);i=r(i,4)|0;for(n=0;(n|0)<(i|0)|0;n=n+4|0)c[(b+n|0)>>2]=0}function M(){var e=0;var t=0;var n=0;var r=0;var i=0;var a=0;var o=0;var f=0;var s=0;var u=0;var y=0;var g=0;var D=0;var M=0;D=m|0;e=w|0;t=e+v|0;n=t+p|0;for(s=0;(s|0)<(l|0);s=s+2|0){y=t;g=n;for(u=0;(u|0)<(h|0);u=u+2|0){r=d[e>>0]|0;i=d[(e+h|0)>>0]|0;a=d[t>>0]|0;o=d[n>>0]|0;M=((r<<16|0)+(a<<8|0)|0)+o|0;f=c[(b+M|0)>>2]|0;if(f);else{f=U(r,a,o)|0;c[(b+M|0)>>2]=f|0}c[D>>2]=f;M=((i<<16|0)+(a<<8|0)|0)+o|0;f=c[(b+M|0)>>2]|0;if(f);else{f=U(i,a,o)|0;c[(b+M|0)>>2]=f|0}c[(D+A|0)>>2]=f;D=D+4|0;e=e+1|0;r=d[e>>0]|0;i=d[(e+h|0)>>0]|0;M=((r<<16|0)+(a<<8|0)|0)+o|0;f=c[(b+M|0)>>2]|0;if(f);else{f=U(r,a,o)|0;c[(b+M|0)>>2]=f|0}c[D>>2]=f;M=((i<<16|0)+(a<<8|0)|0)+o|0;f=c[(b+M|0)>>2]|0;if(f);else{f=U(i,a,o)|0;c[(b+M|0)>>2]=f|0}c[(D+A|0)>>2]=f;D=D+4|0;e=e+1|0;t=t+1|0;n=n+1|0}D=D+A|0;e=e+h|0}}function U(e,t,n){e=e|0;t=t|0;n=n|0;var o=0;var f=0;var s=0;var d=0;var u=0;var c=0;var h=0;var l=0;var v=0;u=r(1192,e-16|0)|0;c=r(1634,n-128|0)|0;h=r(832,n-128|0)|0;l=r(400,t-128|0)|0;v=r(2066,t-128|0)|0;o=(u+c|0)>>10|0;f=((u-h|0)-l|0)>>10|0;s=(u+v|0)>>10|0;if((o&255|0)!=(o|0)|0)o=i(255,a(0,o|0)|0)|0;if((f&255|0)!=(f|0)|0)f=i(255,a(0,f|0)|0)|0;if((s&255|0)!=(s|0)|0)s=i(255,a(0,s|0)|0)|0;d=255;d=d<<8|0;d=d+s|0;d=d<<8|0;d=d+f|0;d=d<<8|0;d=d+o|0;return d|0}return{init:D,doit:M}}(e,0,c);return h.init(t,n),a[r]=h,h.heap=c,h.out=new Uint8Array(c,0,s),h.inp=new Uint8Array(c,s,f),h.outSize=s,h};if("undefined"!=typeof self){var f,s,d,u,c,h=!1,l=!1,v=!1,p=0,y=0,g=0,w=0,m=[],A=[],b=function(e){if(A.length){for(var t=A.shift();t&&t.byteLength!==e;)t=A.shift();if(t)return t}return new ArrayBuffer(e)},D=function(e,t,n,r,i){var a=function(n,i){var a=0;for(a=0;a<16;++a){var o=n+r*a,f=i+r*a;t.set(e.subarray(o,f),o)}},o=function(n,i){var a=0;for(a=0;a<8;++a){var o=n+r/2*a,f=i+r/2*a;t.set(e.subarray(o,f),o)}},f=function(n,r){t.set(e.subarray(n,r),n)},s=n[0],d=n[1];d>0&&(a(s,d),o(n[2],n[3]),o(n[4],n[5])),s=n[6],(d=n[7])>0&&(a(s,d),o(n[8],n[9]),o(n[10],n[11])),s=n[12],(d=n[15])>0&&(f(s,d),f(n[13],n[16]),f(n[14],n[17]))},M=function(e){g=(y=e)-1};self.addEventListener("message",function(e){if(h){if(l&&e.data.reuse&&A.push(e.data.reuse),e.data.buf)return void(v&&0!==w?m.push(e.data):f.decode(new Uint8Array(e.data.buf,e.data.offset||0,e.data.length),e.data.info,function(){v&&p!==g&&postMessage(e.data,[e.data.buf])}));if(e.data.slice){var t=r();if(D(new Uint8Array(e.data.slice),d,e.data.infos[0].sliceInfoAr,e.data.width,e.data.height),e.data.theOne&&(D(d,new Uint8Array(e.data.slice),s,e.data.width,e.data.height),c>e.data.infos[0].timeDecoding&&(e.data.infos[0].timeDecoding=c),e.data.infos[0].timeCopy+=r()-t),postMessage(e.data,[e.data.slice]),0==(w-=1)&&m.length){var n=m.shift();f.decode(new Uint8Array(n.buf,n.offset||0,n.length),n.info,function(){v&&p!==g&&postMessage(n,[n.buf])})}return}if(e.data.setSliceCnt)return void M(e.data.sliceCnt)}else e.data&&"Broadway.js - Worker init"===e.data.type&&(h=!0,f=new i(e.data.options),e.data.options.sliceMode?(l=!0,v=!0,p=e.data.options.sliceNum,M(e.data.options.sliceCnt),f.onPictureDecoded=function(e,t,n,r){var i=new Uint8Array(b(e.length));D(e,i,r[0].sliceInfoAr,t),u=r[0].startDecoding,c=r[0].finishDecoding-u,r[0].timeDecoding=c,r[0].timeCopy=0,postMessage({slice:i.buffer,sliceNum:p,width:t,height:n,infos:r},[i.buffer]),w=y-1,d=e,s=r[0].sliceInfoAr}):e.data.options.reuseMemory?(l=!0,f.onPictureDecoded=function(e,t,n,r){var i=new Uint8Array(b(e.length));i.set(e,0,e.length),postMessage({buf:i.buffer,length:e.length,width:t,height:n,infos:r},[i.buffer])}):f.onPictureDecoded=function(e,t,n,r){e&&(e=new Uint8Array(e));var i=new Uint8Array(e.length);i.set(e,0,e.length),postMessage({buf:i.buffer,length:e.length,width:t,height:n,infos:r},[i.buffer])},postMessage({consoleLog:"broadway worker initialized"}))},!1)}return i.nowValue=r,i}()});